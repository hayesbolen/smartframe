<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Glass Smart Frame</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function LiquidGlassFrame() {
            const [time, setTime] = useState(new Date());
            const [showSetup, setShowSetup] = useState(true);
            const [apiKey, setApiKey] = useState('');
            const [city, setCity] = useState('London');
            const [currentWeather, setCurrentWeather] = useState(null);
            const [forecast, setForecast] = useState([]);
            
            // --- SCREEN WAKE LOCK IMPLEMENTATION ---
            useEffect(() => {
                let wakeLock = null;

                const requestWakeLock = async () => {
                    // Check if the API is supported and the page is served over HTTPS (a requirement)
                    if ('wakeLock' in navigator && document.visibilityState === 'visible') {
                        try {
                            // Request the screen wake lock
                            wakeLock = await navigator.wakeLock.request('screen');
                            console.log('Screen Wake Lock is active!');

                            // Listen for the release event (e.g., if the system releases it)
                            wakeLock.addEventListener('release', () => {
                                console.log('Screen Wake Lock released!');
                            });
                        } catch (err) {
                            // The request failed (e.g., due to low battery or user choice)
                            console.error(`Screen Wake Lock failed: ${err.name}, ${err.message}`);
                        }
                    }
                };

                const handleVisibilityChange = () => {
                    // Re-acquire the lock if the document becomes visible and the lock is null
                    if (document.visibilityState === 'visible' && wakeLock === null) {
                        requestWakeLock();
                    }
                };

                // 1. Try to acquire the lock immediately
                requestWakeLock();

                // 2. Re-acquire the lock if the user switches back to the tab
                document.addEventListener('visibilitychange', handleVisibilityChange);
                
                // 3. Cleanup: release the lock when the component unmounts (user closes the page)
                return () => {
                    document.removeEventListener('visibilitychange', handleVisibilityChange);
                    if (wakeLock !== null && !wakeLock.released) {
                        wakeLock.release().then(() => {
                            console.log('Cleanup: Screen Wake Lock released.');
                            wakeLock = null;
                        });
                    }
                };
            }, []); // Empty dependency array runs this effect only on mount and unmount
            // --- END WAKE LOCK IMPLEMENTATION ---
            
            // Your existing time and weather fetching logic
            useEffect(() => {
                const timer = setInterval(() => {
                    setTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            const fetchWeather = async (apiKey, city) => {
                if (!apiKey || !city) return;
                const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('City not found or API key invalid');
                    const data = await response.json();
                    setCurrentWeather(data);
                    
                    // Fetch forecast
                    const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`;
                    const forecastResponse = await fetch(forecastUrl);
                    if (forecastResponse.ok) {
                        const forecastData = await forecastResponse.json();
                        // Get the forecast for the next 4 midday periods (approx 24-hour separation)
                        const middayForecasts = forecastData.list.filter(item => {
                            return item.dt_txt.includes('12:00:00');
                        }).slice(0, 4);
                        setForecast(middayForecasts);
                    }
                } catch (error) {
                    console.error('Weather fetch error:', error);
                    setCurrentWeather(null);
                    setForecast([]);
                }
            };

            // Initial fetch and periodic refresh
            useEffect(() => {
                if (apiKey && city) {
                    fetchWeather(apiKey, city);
                    const intervalId = setInterval(() => fetchWeather(apiKey, city), 600000); // Refresh every 10 minutes
                    return () => clearInterval(intervalId);
                }
            }, [apiKey, city]);

            const hour = time.getHours();
            const minute = time.getMinutes().toString().padStart(2, '0');
            const day = time.toLocaleDateString('en-US', { weekday: 'long' });
            const date = time.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
            
            const isDayTime = hour >= 6 && hour <= 19;
            const theme = isDayTime ? 'from-blue-400 to-sky-600' : 'from-gray-800 to-indigo-900';
            const shadow = isDayTime ? 'shadow-blue-500/50' : 'shadow-indigo-500/50';

            const handleSubmit = (e) => {
                e.preventDefault();
                setShowSetup(false);
            };

            const getIcon = (weatherCode) => {
                // Simplified icon mapping (you can expand this)
                if (weatherCode >= 200 && weatherCode < 300) return '‚õàÔ∏è'; // Thunderstorm
                if (weatherCode >= 300 && weatherCode < 500) return 'üåßÔ∏è'; // Drizzle
                if (weatherCode >= 500 && weatherCode < 600) return 'üåßÔ∏è'; // Rain
                if (weatherCode >= 600 && weatherCode < 700) return '‚ùÑÔ∏è'; // Snow
                if (weatherCode >= 700 && weatherCode < 800) return 'üå´Ô∏è'; // Atmosphere
                if (weatherCode === 800) return isDayTime ? '‚òÄÔ∏è' : 'üåô'; // Clear
                if (weatherCode > 800) return '‚òÅÔ∏è'; // Clouds
                return '‚ùì';
            };

            if (showSetup) {
                return (
                    <div className={`h-screen w-screen flex items-center justify-center bg-gradient-to-br ${theme}`}>
                        <div className="bg-white bg-opacity-20 backdrop-filter backdrop-blur-md p-10 rounded-3xl max-w-md w-full shadow-2xl">
                            <h2 className="text-2xl text-white font-bold mb-6 text-center">Setup Smart Frame</h2>
                            <form onSubmit={handleSubmit}>
                                <div className="mb-4">
                                    <label className="block text-white text-sm font-bold mb-2" htmlFor="city">
                                        City Name (e.g., London)
                                    </label>
                                    <input
                                        id="city"
                                        type="text"
                                        value={city}
                                        onChange={(e) => setCity(e.target.value)}
                                        className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                        required
                                    />
                                </div>
                                <div className="mb-6">
                                    <label className="block text-white text-sm font-bold mb-2" htmlFor="apiKey">
                                        OpenWeatherMap API Key
                                    </label>
                                    <input
                                        id="apiKey"
                                        type="text"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline"
                                        required
                                    />
                                </div>
                                <div className="flex items-center justify-center">
                                    <button
                                        type="submit"
                                        className="bg-white bg-opacity-30 hover:bg-opacity-40 text-white font-bold py-2 px-6 rounded-full focus:outline-none focus:shadow-outline transition duration-200"
                                    >
                                        Save & Start
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`h-screen w-screen flex items-center justify-center bg-gradient-to-br ${theme} transition-all duration-1000`}>
                    <div className={`p-8 rounded-3xl max-w-4xl w-full mx-4 transform transition-all duration-1000 backdrop-filter backdrop-blur-2xl bg-white bg-opacity-10 shadow-2xl ${shadow}`}>
                        
                        {/* Header: Time and Date */}
                        <div className="flex justify-between items-start mb-6 border-b border-white border-opacity-30 pb-4">
                            <div>
                                <div className="text-8xl md:text-9xl text-white font-light leading-none">
                                    {hour % 12 || 12}:{minute}
                                </div>
                                <div className="text-4xl text-white text-opacity-80 mt-2 font-light">
                                    {hour >= 12 ? 'PM' : 'AM'}
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-3xl text-white font-light">{day}</div>
                                <div className="text-2xl text-white text-opacity-70 font-light">{date}</div>
                            </div>
                        </div>

                        {/* Current Weather */}
                        {currentWeather ? (
                            <div className="flex items-center justify-between mb-8 border-b border-white border-opacity-30 pb-6">
                                <div className="flex items-center gap-4">
                                    <div className="text-7xl">{getIcon(currentWeather.weather[0].id)}</div>
                                    <div>
                                        <div className="text-4xl text-white font-medium">{currentWeather.weather[0].main}</div>
                                        <div className="text-2xl text-white text-opacity-70">{currentWeather.name}</div>
                                    </div>
                                </div>
                                <div className="text-6xl text-white font-light">
                                    {Math.round(currentWeather.main.temp)}¬∞C
                                </div>
                            </div>
                        ) : (
                            <div className="text-center text-white text-xl p-8">Loading weather... or check your API key/city.</div>
                        )}

                        {/* Forecast and Details */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            {forecast.map((item, index) => (
                                <div key={index} className="bg-white bg-opacity-15 p-4 rounded-2xl text-center">
                                    <div className="text-xs text-white text-opacity-70 uppercase mb-2">
                                        {new Date(item.dt * 1000).toLocaleDateString('en-US', { weekday: 'short' })}
                                    </div>
                                    <div className="text-3xl mb-2">{getIcon(item.weather[0].id)}</div>
                                    <div className="text-xl text-white font-light">{Math.round(item.main.temp)}¬∞C</div>
                                </div>
                            ))}
                        </div>
                        
                        {/* Quick Info Grid */}
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-6">

                            {/* Wind Speed */}
                            <div className="bg-white bg-opacity-15 p-5 rounded-2xl">
                                <div className="flex items-center gap-3 mb-3">
                                    <span className="text-3xl">üí®</span>
                                    <div className="text-xs text-white text-opacity-70 uppercase">Wind Speed</div>
                                </div>
                                <div className="text-4xl text-white font-light">
                                    {currentWeather ? Math.round(currentWeather.wind.speed) : '--'} km/h
                                </div>
                                <div className="mt-3 text-sm text-white text-opacity-70">
                                    {currentWeather && currentWeather.wind.deg ? `from ${currentWeather.wind.deg}¬∞` : ''}
                                </div>
                            </div>

                            {/* Feels Like */}
                            <div className="bg-white bg-opacity-15 p-5 rounded-2xl">
                                <div className="flex items-center gap-3 mb-3">
                                    <span className="text-3xl">üå°Ô∏è</span>
                                    <div className="text-xs text-white text-opacity-70 uppercase">Feels Like</div>
                                </div>
                                <div className="text-4xl text-white font-light">
                                    {currentWeather ? Math.round(currentWeather.main.feels_like) : '--'}¬∞C
                                </div>
                                <div className="mt-3 text-sm text-white text-opacity-70">
                                    {currentWeather ? `Max: ${Math.round(currentWeather.main.temp_max)}¬∞C` : ''}
                                </div>
                            </div>

                            {/* Humidity */}
                            <div className="bg-white bg-opacity-15 p-5 rounded-2xl">
                                <div className="flex items-center gap-3 mb-3">
                                    <span className="text-3xl">üíß</span>
                                    <div className="text-xs text-white text-opacity-70 uppercase">Humidity</div>
                                </div>
                                <div className="text-4xl text-white font-light">
                                    {currentWeather ? currentWeather.main.humidity : '--'}%
                                </div>
                                <div className="mt-3 bg-white bg-opacity-20 rounded-full h-3 overflow-hidden">
                                    <div 
                                        className="bg-blue-300 h-full rounded-full transition-all duration-500"
                                        style={{width: currentWeather ? `${currentWeather.main.humidity}%` : '0%'}}
                                    ></div>
                                </div>
                            </div>

                        </div>
   
                    </div>
                </div>
            );
        }

        ReactDOM.render(<LiquidGlassFrame />, document.getElementById('root'));
    </script>
</body>
</html>
